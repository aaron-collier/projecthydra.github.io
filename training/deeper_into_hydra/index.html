---
layout: deck
title: "Dive Deeper into Hydra"
---

<section class="slide" id="title-slide">
  <h1>Dive Deeper into Hydra</h1>
  <p><i>This is a draft for a course first offered at Code4Lib 2016. It is not complete. Caveat emptor.</i></p>
</section>

<section class="slide" style="text-align: center">
  <h2 style="font-family: 'Amarante', cursive; color:white; background-color: #cc0000; border-radius: 40px; font-size: 2em; display: inline-block; padding: 0 30px 0 30px; margin: 10px; text-align: center; text-transform: uppercase;">Choose your own adventure</h2>
  <h3 style="font-family: 'Amarante', cursive; text-align: center; text-transform: uppercase; color: #ffa40a">You're the star of the story!</br>
    Choose from 2 possible endings</h3>
  <img src="stonehenge.png" style="height: 60vh">
  <div class="row">
    <div class="col-sm-6">
      <h4 style="font-family: 'Amarante', cursive; text-align: center; text-transform: uppercase; color: #ffa40a"><a href="#slide-2">Theory</a></h4>
    </div>
    <div class="col-sm-6">
      <h4 style="font-family: 'Amarante', cursive; text-align: center; text-transform: uppercase; color: #ffa40a"><a href="#slide-33">Practice</a></h4>
    </div>
  </div>
</section>

<section class="slide">
  <h2>Legacy data modeling</h2>
  <img src="legacy_modeling.svg">
</section>

<section class="slide">
  <h2>Legacy data modeling</h2>
  <img src="legacy_HABTM.svg">
</section>

<section class="slide">
  <h2>Shortcomings of legacy modeling</h2>
  <ul>
    <li>Every project has a unique structure</li>
    <li>Lack of ordering</li>
    <li>Resource contention</li>
  </ul>
</section>

<section class="slide">
  <img src="pcdm.png" alt="PCDM" style="height: 100vh">
  <aside>History</aside>
</section>

<section class="slide">
  <h2>Structural model</h2>
  <img src="outdated_hydra_works.png" style="height: 70vh">
</section>

<section class="slide">
  <h2>Hands on</h2>
  <pre><code>
  gem 'hydra', '9.1.0'
  gem 'hydra-works', '0.7.0'
  </code></pre>
  <pre><code>
  bundle install
  rails generate hydra:install
  rake hydra:server
  </code></pre>

  Then open a new tab.
</section>

<section class="slide">
  <h2>Hands on</h2>
  <pre><code>
class Collection &lt; ActiveFedora::Base
  include Hydra::Works::CollectionBehavior
  property :title, predicate: ::RDF::Vocab::DC.title
end
  </code></pre>
</section>

<section class="slide">
  <h2>Hands on</h2>
  <pre><code>
class BibliographicWork &lt; ActiveFedora::Base
  include Hydra::Works::WorkBehavior
  property :title, predicate: ::RDF::DC.title
  property :author, predicate: ::RDF::DC.creator
  property :abstract, predicate: ::RDF::DC.abstract
end
  </code></pre>
</section>

<section class="slide">
  <h2>Hands on</h2>
  <pre><code>
class FileSet &lt; ActiveFedora::Base
  include Hydra::Works::FileSetBehavior
  property :title, predicate: ::RDF::DC.title
end
  </code></pre>
</section>

<section class="slide">
  <h2>Hands on</h2>
  <pre><code>
col = Collection.create(
        id: 'col-1',
        title: ["Works by Edgar Allan Poe"])
col.uri
=> #&lt;RDF::URI:0x3ffb2941693c URI:http://127.0.0.1:8984/rest/dev/col-1&gt;
  </code></pre>
</section>

<section class="slide">
  <h2>Hands on</h2>
  <pre><code>
bw = BibliographicWork.create(
       id: 'work-1',
       title: ["The Raven"],
       author: ["Poe, Edgar Allan"])
bw.uri
=> #&lt;RDF::URI:0x3ffb2941693c URI:http://127.0.0.1:8984/rest/dev/work-1&gt;
  </code></pre>
</section>

<section class="slide">
  <h2>Hands on</h2>
  <pre><code>
fs = FileSet.create(id: 'fileset-1', title: ["The PDF"])
fs.uri
=> #&lt;RDF::URI:0x3ffb2941693c URI:http://127.0.0.1:8984/rest/dev/work-1&gt;
  </code></pre>
</section>

<section class="slide">
  <h2>Hands on</h2>
  <pre><code>
  col.members &lt;&lt; bw
  col.save
  bw.members &lt;&lt; fs
  bw.save
  </code></pre>
</section>

<section class="slide">
  <h2>Hands on</h2>
  <pre><code>
  col.works
=&gt; [#&lt;BibliographicWork id: "work-1", title: "The Raven", author: "Poe, Edgar Allan", head_id: nil, tail_id: nil&gt;]

bw.in_collections
=&gt; [#&lt;Collection id: "col-1", title: "Works by Edgar Allan Poe", head_id: nil, tail_id: nil&gt;]

bw.file_sets
=&gt; [#&lt;FileSet id: "fileset-1", title: "The Raven pdf", head_id: nil, tail_id: nil&gt;]

fs.in_works       ### TODO in_works returns []
=&gt; [#&lt;BibliographicWork id: "work-1", title: "The Raven", author: "Poe, Edgar Allan", abstract: "A lonely man tries to ease his 'sorrow for the lost Lenore', by distracting his mind with old books of 'forgotten lore'.", head_id: nil, tail_id: nil&gt;]
  </code></pre>
</section>

<section class="slide">
  <h2>Projection onto LDP</h2>
</section>
<section class="slide">
  <h2>LDP Containers</h2>
</section>
<section class="slide">
  <h2>LDP Basic Container</h2>
  <pre class="slide"><code>&lt;/blog/entry1&gt; a ldp:Container .
&lt;/blog/entry1&gt; dc:title "First blog entry" .</code></pre>
  <pre class="slide"><code>&lt;/blog/entry1/comment1&gt; a ldp:RDFSource .
&lt;/blog/entry1/comment1&gt; dc:title "this is a new comment" .</code></pre>
</section>

<section class="slide">
  <h2>LDP Basic Container</h2>
  <pre><code>&lt;/blog/entry1&gt; a ldp:Container .
&lt;/blog/entry1&gt; dc:title "First blog entry" .
&lt;/blog/entry1&gt; ldp:contains &lt;/blog/entry1/comment1&gt; .</code></pre>
</section>

<section class="slide">
  <h2>LDP Direct Container</h2>
  <pre class="slide"><code>&lt;/book1/files&gt; a ldp:DirectContainer .
&lt;/book1/files&gt; ldp:membershipResource &lt;/book1&gt; .
&lt;/book1/files&gt; ldp:hasMemberRelation pcdm:hasFile .
&lt;/book1/files&gt; ldp:contains &lt;/book1/files/file1&gt; .</code></pre>
</section>

<section class="slide">
  <h2>LDP Direct Container</h2>
  <pre><code>&lt;/book1&gt; pcdm:hasFile &lt;/book1/files/file1&gt; .</code></pre>
</section>

<section class="slide">
  <h2>LDP Indirect Container</h2>
  <pre class="slide"><code>&lt;/collection1/members&gt; a ldp:IndirectContainer .
&lt;/collection1/members&gt; ldp:membershipResource &lt;/collection1&gt; .
&lt;/collection1/members&gt; ldp:hasMemberRelation pcdm:hasMember .
&lt;/collection1/members&gt; ldp:insertedContentRelation ore:proxyFor .
&lt;/collection1/members&gt; ldp:contains &lt;/book1&gt; .</code></pre>
</section>

<section class="slide">
  <h2>LDP Indirect Container</h2>
  <pre><code>&lt;/collection1&gt; pcdm:hasMember &lt;/book1&gt; .</code></pre>

  <pre class="slide"><code>&lt;/collection1/members/proxy1&gt; ore:proxyFor &lt;/book1&gt; .</code></pre>
</section>

<section class="slide">
  <h4 style="text-align: center; padding-top: 30vh">Let's investigate...</h4>
</section>

<section class="slide">
  <h2>ORE Aggregation</h2>
  <img src="ore_proxy.jpg">
</section>

<section class="slide">
  <h2>List node</h2>
  <p>Allows us to reorder a whole list in a single HTTP request</p>
  <table class="table table-bordered table-hover">
    <tr><td>&lt;book1/list_source&gt;</td><td>iana:first</td><td>&lt;book1/list_source#g1234&gt;</td></tr>
    <tr><td>&lt;book1/list_source&gt;</td><td>iana:last</td><td>&lt;book1/list_source#g5678&gt;</td></tr>
    <tr><td>&lt;book1/list_source#g1234&gt;</td><td>ore:proxyFor</td><td>&lt;page1&gt;</td></tr>
    <tr><td>&lt;book1/list_source#g1234&gt;</td><td>ore:proxyIn	</td><td>&lt;book1&gt;</td></tr>
    <tr><td>&lt;book1/list_source#g1234&gt;</td><td>iana:next</td><td>&lt;book1/list_source#g5678&gt;</td></tr>
    <tr><td>&lt;book1/list_source#g5678&gt;</td><td>ore:proxyFor</td><td>&lt;page1&gt;</td></tr>
    <tr><td>&lt;book1/list_source#g5678&gt;</td><td>ore:proxyIn</td><td>&lt;book1&gt;</td></tr>
    <tr><td>&lt;book1/list_source#g5678&gt;</td><td>iana:prev</td><td>&lt;book1/list_source#g1234&gt;</td></tr>
</table>
</section>

<section class="slide">
<h2>Problems</h2>
<ul>
    <li>Lots of writes</li>
    <li>Resource contention</li>
  </ul>
  <aside>
    * Explain multiple process writing to a linked list.
    * Redlock
  </aside>
</section>

<section class="slide">
  <h2 >The responsibilities of Hydra</h2>
  For each object type, map from...
  <ul>
    <li class="slide">repository representation to object properties</li>
    <li class="slide">object properties to repository representation</li>
    <li class="slide">object properties to an index representation</li>
    <li class="slide">index representation to an HTML show page</li>
    <li class="slide">object properties to an HTML form</li>
    <li class="slide">HTML form output to object properties</li>
    <li class="slide">index search results to an HTML page</li>
  </ul>
</section>

<section class="slide">
  <h1 style="font-family: 'Cherry Cream Soda', serif">Curation Concerns</h1>
</section>
<section class="slide">
  <h2>Model</h2>
</section>
<section class="slide">
  <h2>Actor</h2>
</section>
<section class="slide">
  <h2>Indexer</h2>
</section>
<section class="slide">
  <h2>Presenter</h2>
  What is a presenter for?
</section>
<section class="slide">
  <h2>Customize the Presenter</h2>
  Display a new field: <code>:restrictions</code>
</section>

<section class="slide">
  <h3>Create a presenter</h3>
    <pre><code>
    class AudioRecordingPresenter &lt; CurationConcerns::WorkShowPresenter
      delegate :restrictions, to: :solr_document
    end
    </code></pre>
</section>

<section class="slide">
  <h3>Update the solr document</h3>
    <pre><code>
    # app/models/solr_document.rb
    class SolrDocument
      ...
      def restrictions
        fetch('restrictions_tesim', [])
      end
      ...
    end
    </code></pre>
</section>

<section class="slide">
  <h3>Update the controller</h3>
      <pre><code>
class CurationConcerns::AudioRecordingsController &lt; ApplicationController
  include CurationConcerns::CurationConcernController
  set_curation_concern_type AudioRecording

  # Gives the class of the show presenter. Override this if you want
  # to use a different presenter.
  def show_presenter
    # CurationConcerns::WorkShowPresenter
    ::AudioRecordingPresenter
  end
end
      </code></pre>
</section>
<section class="slide">
  <h3>Update the view partial</h3>
      <pre><code>
      copy <CurationConcern path>/app/views/curation_concerns/base/_attribute_rows.html.erb to
      app/views/curation_concerns/audio_recordings/_attribute_rows.html.erb
      </code></pre>

</section>

<section class="slide">
  <h2>Form</h2>
        Replace the "rights" field with "copyright_status"
  <pre><code>
    module CurationConcerns
      class AudioRecordingForm &lt; CurationConcerns::Forms::WorkForm
        self.model_class = ::AudioRecording
        delegate :copyright_status, to: :model

        self.terms -= [:rights]
        self.terms += [:copyright_status]
      end
    end
   </code></pre>
</section>
